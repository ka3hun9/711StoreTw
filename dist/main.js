import*as a from"fs";import*as t from"path";import e from"axios";import n from"qs";import{XMLParser as o}from"fast-xml-parser";let r="",i="",s="";const c=[["13","嘉義市"],["14","嘉義縣"],["15","台南市"],["17","高雄市"],["19","屏東縣"],["20","宜蘭縣"],["21","花蓮縣"],["22","台東縣"],["23","澎湖縣"],["24","連江縣"],["25","金門縣"]].map((a=>({label:a[1],value:a[1],state:a[1],serial:a[0],children:[]})));async function d(a,{serial:t,state:e,town:n,road:o}){let r=null;switch(!0){case!!o:r=await async function(a,t,e){const n={commandid:"SearchStore",city:a,town:t,roadname:e,ID:"",StoreName:"",SpecialStore_Kind:"",leftMenuChecked:"",address:""};return await l(n,"GeoPosition",(a=>({label:`<${a.POIName}> ${a.Address}`,value:`<${a.POIName}> ${a.Address}`})))}(e,n,o);break;case!!n:r=await async function(a,t){const e={commandid:"SearchRoad",city:a,town:t,ID:"",StoreName:"",SpecialStore_Kind:"",leftMenuChecked:""};return await l(e,"RoadName",(a=>({label:a.rd_name_1+a.section_1,value:a.rd_name_1+a.section_1,road:a.rd_name_1+a.section_1,children:[]})))}(e,n);break;case!!t:r=await async function(a){const t={commandid:"GetTown",cityid:a,leftMenuChecked:""};return await l(t,"GeoPosition",(a=>({label:a.TownName,value:a.TownName,town:a.TownName,children:[]})))}(t)}return r&&(a.children=r),r}async function l(a,t,r){const{status:i,data:s}=await e.post("https://emap.pcsc.com.tw/EMapSDK.aspx",n.stringify(a));if(200===i){const a=(new o).parse(s).iMapSDKOutput[t];return Array.isArray(a)?a.map(r):a?[r(a)]:[]}throw new Error(`${t} 请求错误.`)}(function e(n){let o=n.map(((n,l)=>async function(){r=n.state?n.state:r,i=n.state?"":n.town?n.town:i,s=n.state||n.town?"":n.road?n.road:s;const m=o[++l],w=await d(n,{serial:n.serial,state:r,town:i,road:s});w[0]&&void 0!==w[0].children&&await e(w)[0](),m?await m():a.writeFileSync(t.resolve(process.cwd(),"./dist/output.json"),JSON.stringify(c))}));return o})(c)[0]();
